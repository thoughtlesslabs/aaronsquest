pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
-- aaron's quest
-- a thoughtless labs experiment

function _init()
 _update60= update_menu
	_draw= draw_menu
	init_player()
	init_map()
end

function init_map()
 wall = {49,33,34,21,5}
 door = {5}
 opendoor ={6}
 crate = {21}
end

function init_player()
	p = {}
	p.x = 1
	p.y = 1
	p.sprite = 8
end


-->8
-- update functions

function update_menu()
	if btnp(5) then
		_update60 = update_game
		_draw = draw_game
	end
end

function update_game()
	move_player()
end

function move_player()
	
	newx = p.x
	newy = p.y

	if btnp(0) then newx -=1 push="right" end
	if btnp(1) then newx +=1 push="left" end
	if btnp(2) then newy -=1 push="up" end
	if btnp(3) then newy +=1 push="down" end
	
	interact(newx,newy)
	
	if can_move(newx,newy) then
		p.x = mid(0,newx,127)
		p.y = mid(0,newy,63)
	else
		sfx(0)
	end
end
-->8
-- draw functions

function draw_menu()
	cls()
	print("press ❎ to start",20,69,9)
end

function draw_game()
	cls()
	draw_map()
	draw_player()
	print(x,80,0,7)
end

function draw_map()

	mapx = flr(p.x/16)*16
	mapy = flr(p.y/16)*16
	
	camera(mapx*8,mapy*8)
	
	map(0,0,0,0,128,64)
end

function draw_player()
	spr(p.sprite,p.x*8,p.y*8)
end
-->8
-- game functions

--  check if the player can move
function can_move(x,y)
	return not is_tile(wall,x,y)
end

-- check for tile type
function is_tile(tile_type,x,y)
	tile = mget(x,y)
	for i=1,#tile_type do
		if tile == tile_type[i] then
			return true
		end
	end
	return false
end

-- interaction options based
-- on the tile
function interact(x,y)
	if is_tile(crate,x,y) then
		move_crate(x,y)
	elseif is_tile(door,x,y) then
	 swap_tile(x,y)
	end
end
		
		
-- swap and unswap tiles
function swap_tile(x,y)
	tile = mget(x,y)
	mset(x,y,tile+1)
end

-- push a crate
function move_crate(x,y)
	nx = x
	ny = y
	
	if push == "left" then
		nx +=1
	elseif push == "right" then
	 nx -=1
	elseif push == "up" then
		ny -=1
	elseif push == "down" then
		ny +=1
	end
	if can_move(nx,ny) then
		mset(x,y,tile)
		mset(nx,ny,21)
	end
end


	
__gfx__
00000000333333333333333300000000000000000055550050000000000000000806660000000000000000000000000000000000000000000000000000000000
00000000333333333b3b333300000000000000000554255050000000000000000086550700000000000000000000000000000000000000000000000000000000
000000003333333333b3333300000000000000005544245550000000000000000006657000000000000000000000000000000000000000000000000000000000
00000000333333333333333300000000000000005424442550000000000000000066674000000000000000000000000000000000000000000000000000000000
0000000033333333333333330000000000000000542444255000000000000000006d754000000000000000000000000000000000000000000000000000000000
00000000333333333333b3b300000000000000005424492550000000000000000097664000000000000000000000000000000000000000000000000000000000
000000003333333333333b3300000000000000005444242550000000000000000099d64000000000000000000000000000000000000000000000000000000000
00000000333333333333333300000000000000005244242550000000000000000006d60000000000000000000000000000000000000000000000000000000000
00000000449444444444444400000000000000005555555500000000000000000b8bbbb000000000000000000000000000000000000000000000000000000000
0000000044444924444444440000000000000000525222250000000000000000bbbbbb8b00000000000000000000000000000000000000000000000000000000
00000000444444444444444400000000000000005454545500000000000000008bb8bbbb00000000000000000000000000000000000000000000000000000000
0000000044944244444444440000000000000000544454450000000000000000bbbbb8bb00000000000000000000000000000000000000000000000000000000
00000000244444444444444400000000000000005254545500000000000000000bbbbbb000000000000000000000000000000000000000000000000000000000
00000000444944944444444400000000000000005254544500000000000000000404440000000000000000000000000000000000000000000000000000000000
00000000494444444444444400000000000000005222542500000000000000000044500000000000000000000000000000000000000000000000000000000000
00000000442444944444444400000000000000005555555500000000000000000004400000000000000000000000000000000000000000000000000000000000
00000000cccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccc777cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccccc77ccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccccccccc700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccccccc77700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccc77ccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccc77cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006d6666664444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006d6666664444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddddd6dd4444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666d64444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666d64444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddd6ddd64444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000066d666664444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000066d666664444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3131313131313101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132323232323101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132323232323101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132323232323101010115010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132323232323101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131310531313101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000038000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000e0500e0500e0500e0500d050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
