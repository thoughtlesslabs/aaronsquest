pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
-- aaron's quest
-- a thoughtless labs experiment

function _init()
 _update60= update_menu
	_draw= draw_menu
	crates = {}
	init_player()
	init_map()
	init_crates()
end

function init_map()
 wall = {49,33,34,21,5,50,21}
 door = {5}
 opendoor ={6}
end

function init_player()
	p = {}
	p.x = 1
	p.y = 1
	p.sprite = 8
end

function init_crates()
	crate = {}
	crate.x = 4
	crate.y = 10
	crate.sprite = 21
	add(crates,crate)
end


-->8
-- update functions

function update_menu()
	if btnp(5) then
		_update60 = update_game
		_draw = draw_game
	end
end

function update_game()
	move_player()
end

function move_player()
	
	newx = p.x
	newy = p.y

	if btnp(0) then newx -=1 push="right" end
	if btnp(1) then newx +=1 push="left" end
	if btnp(2) then newy -=1 push="up" end
	if btnp(3) then newy +=1 push="down" end
	
	interact(newx,newy)
	
	if can_move(newx,newy) then
		p.x = mid(0,newx,127)
		p.y = mid(0,newy,63)
	else
		sfx(0)
	end
end
-->8
-- draw functions

function draw_menu()
	cls()
	print("press ❎ to start",20,69,9)
end

function draw_game()
	cls()
	draw_map()
	draw_player()
	draw_crate()
	print(#crates,80,0,7)
end

function draw_map()

	mapx = flr(p.x/16)*16
	mapy = flr(p.y/16)*16
	
	camera(mapx*8,mapy*8)
	
	map(0,0,0,0,128,64)
end

function draw_player()
	spr(p.sprite,p.x*8,p.y*8)
end

function draw_crate()
 spr(crate.sprite,crate.x*8,crate.y*8)
end
-->8
-- game functions

--  check if the player can move
function can_move(x,y)
	if is_tile(wall,x,y) or is_crate(x,y) then
		return false
	else
		return true
	end
end

-- check for tile type
function is_tile(tile_type,x,y)
	tile = mget(x,y)
	for i=1,#tile_type do
		if tile == tile_type[i] then
			return true
		end
	end
	return false
end

-- check if hit crate
function is_crate(x,y)
	if x == crate.x and y==crate.y then
		return true
	end
	return false
end

-- interaction options based
-- on the tile
function interact(x,y)
	if is_tile(door,x,y) then
	 swap_tile(x,y)
	end
	if is_crate(x,y) then
		move_crate(x,y)
	end
end
		
		
-- swap and unswap tiles
function swap_tile(x,y)
	tile = mget(x,y)
	mset(x,y,tile+1)
end

-- push a crate
function move_crate(x,y)
	nx = x
	ny = y
	
	if push == "left" then
		nx +=1
	elseif push == "right" then
	 nx -=1
	elseif push == "up" then
		ny -=1
	elseif push == "down" then
		ny +=1
	end
	
	if can_move(nx,ny) then
		crate.x = mid(0,nx,127)
		crate.y = mid(0,ny,63)
	end
	

end


	
__gfx__
00000000333333333333333300000000000000004455554454444444000000000806660000000000000000000000000000000000000000000000000000000000
00000000333333333b3b333300000000000000004556455454444444000000000086550700000000000000000000000000000000000000000000000000000000
000000003333333333b3333300000000000000005566465554444444000000000006657000000000000000000000000000000000000000000000000000000000
00000000333333333333333300000000000000005646466554444444000000000066674000000000000000000000000000000000000000000000000000000000
0000000033333333333333330000000000000000564666655444444400000000006d754000000000000000000000000000000000000000000000000000000000
00000000333333333333b3b300000000000000005646696554444444000000000097664000000000000000000000000000000000000000000000000000000000
000000003333333333333b3300000000000000005666646554444444000000000099d64000000000000000000000000000000000000000000000000000000000
00000000333333333333333300000000000000005666646554444444000000000006d60000000000000000000000000000000000000000000000000000000000
00000000445444444444444400000000000000009999999900000000000000000b8bbbb000000000000000000000000000000000000000000000000000000000
0000000044444954444444440000000000000000929222290000000000000000bbbbbb8b00000000000000000000000000000000000000000000000000000000
00000000444444444444444400000000000000009494949900000000000000008bb8bbbb00000000000000000000000000000000000000000000000000000000
0000000044944544444444440000000000000000944494490000000000000000bbbbb8bb00000000000000000000000000000000000000000000000000000000
00000000544444444444444400000000000000009254949900000000000000000bbbbbb000000000000000000000000000000000000000000000000000000000
00000000444544944444444400000000000000009254944900000000000000000404440000000000000000000000000000000000000000000000000000000000
00000000494444444444444400000000000000009222942900000000000000000044500000000000000000000000000000000000000000000000000000000000
00000000445444544444444400000000000000009999999900000000000000000004400000000000000000000000000000000000000000000000000000000000
00000000cccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccc777cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccccc77ccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccccccccc700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccccccc77700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccc77ccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccc77cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006d6666663333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006d6666663333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddddd6dd3366763300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666d63367666300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666d63666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddd6ddd66666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000066d666666666655300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000066d666665555553300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3131313131313122210101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3112121112123121210202020201010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3111121211123122210202010101010101010101013201010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3112111211123121210202020101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3111121211113122210202010101010132010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131310531313121210202010201010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2221221121212221220101010102020201010101010101010101010101010101010101010101010101010101010101010101000038000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2122211122212222010101010102020102020101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101011211010101151515010202020202020201010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010112013201010115020202020202020201010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010112010101010115320102020202020101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020111010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020211111212121212121211121211121112110101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020201010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101020101010101010101010101010101010132010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101320101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000e0500e0500e0500e0500d050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
